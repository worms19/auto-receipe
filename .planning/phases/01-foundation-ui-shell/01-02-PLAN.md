---
phase: 01-foundation-ui-shell
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - app/(tabs)/index.tsx
  - app/recipe/[id].tsx
  - components/RecipeCard.tsx
  - components/RecipeDetail.tsx
  - components/EmptyState.tsx
  - lib/mock-data.ts
  - app/_layout.tsx
autonomous: false

must_haves:
  truths:
    - "User can view a scrollable list of saved recipes with titles and thumbnails"
    - "User can tap a recipe to see full detail view with ingredients, steps, photo, and original URL link"
    - "User can save a recipe and it persists after app restart"
    - "User can delete a recipe from the collection"
    - "Recipes are viewable offline after saving (images cached to disk)"
  artifacts:
    - path: "app/(tabs)/index.tsx"
      provides: "Recipe list screen with FlatList"
      contains: "FlatList"
    - path: "app/recipe/[id].tsx"
      provides: "Recipe detail screen with dynamic route"
      contains: "useLocalSearchParams"
    - path: "components/RecipeCard.tsx"
      provides: "Recipe list item component with thumbnail"
      contains: "expo-image"
    - path: "components/RecipeDetail.tsx"
      provides: "Full recipe view with ingredients and steps"
      contains: "ingredients"
    - path: "lib/mock-data.ts"
      provides: "Sample recipes for testing"
      exports: ["mockRecipes", "seedDatabase"]
  key_links:
    - from: "app/(tabs)/index.tsx"
      to: "lib/db.ts"
      via: "useSQLiteContext + getAllRecipes"
      pattern: "getAllRecipes.*db"
    - from: "app/(tabs)/index.tsx"
      to: "app/recipe/[id].tsx"
      via: "Link component navigation"
      pattern: "Link.*href.*recipe"
    - from: "app/recipe/[id].tsx"
      to: "lib/db.ts"
      via: "useSQLiteContext + getRecipeById + deleteRecipe"
      pattern: "(getRecipeById|deleteRecipe)"
    - from: "components/RecipeCard.tsx"
      to: "expo-image"
      via: "Image component with disk caching"
      pattern: "cachePolicy.*disk"
    - from: "app/recipe/[id].tsx"
      to: "expo-linking"
      via: "Linking.openURL for Instagram"
      pattern: "Linking\\.openURL"
---

<objective>
Build the complete recipe UI: scrollable list with thumbnails, detail view with ingredients/steps/photo/link, delete functionality, and mock data for testing.

Purpose: Deliver all Phase 1 user-facing features so the app is usable with mock data before real processing is added.
Output: Fully functional recipe collection app with list view, detail view, delete capability, and offline image support.
</objective>

<execution_context>
@/Users/damienanselmi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/damienanselmi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-ui-shell/01-RESEARCH.md
@.planning/phases/01-foundation-ui-shell/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Mock Data and Recipe List Screen</name>
  <files>
    lib/mock-data.ts
    components/RecipeCard.tsx
    components/EmptyState.tsx
    app/(tabs)/index.tsx
  </files>
  <action>
Create mock recipe data and the main recipe list screen:

1. Create `lib/mock-data.ts` with sample recipes:
   ```typescript
   import { NewRecipe } from './types';
   import { SQLiteDatabase } from 'expo-sqlite';
   import { saveRecipe, getAllRecipes } from './db';

   export const mockRecipes: NewRecipe[] = [
     {
       title: "Creamy Garlic Tuscan Shrimp",
       ingredients: [
         "1 lb large shrimp, peeled and deveined",
         "4 cloves garlic, minced",
         "1 cup heavy cream",
         "1/2 cup sun-dried tomatoes, chopped",
         "2 cups fresh spinach",
         "1/2 cup parmesan cheese, grated",
         "2 tbsp olive oil",
         "Salt and pepper to taste",
         "Italian seasoning to taste"
       ],
       steps: [
         "Heat olive oil in a large skillet over medium-high heat.",
         "Season shrimp with salt, pepper, and Italian seasoning. Cook 2-3 minutes per side until pink. Remove and set aside.",
         "In the same pan, add garlic and cook for 30 seconds until fragrant.",
         "Pour in heavy cream and bring to a simmer.",
         "Add sun-dried tomatoes and parmesan cheese. Stir until cheese melts.",
         "Add spinach and cook until wilted, about 2 minutes.",
         "Return shrimp to the pan and toss to coat with sauce.",
         "Serve immediately over pasta or with crusty bread."
       ],
       sourceUrl: "https://www.instagram.com/p/example1/",
       thumbnailUrl: "https://picsum.photos/seed/shrimp/400/300"
     },
     {
       title: "One-Pan Lemon Herb Chicken",
       ingredients: [
         "4 chicken thighs, bone-in skin-on",
         "1 lb baby potatoes, halved",
         "1 lemon, sliced",
         "4 cloves garlic, smashed",
         "Fresh rosemary and thyme",
         "3 tbsp olive oil",
         "Salt and pepper"
       ],
       steps: [
         "Preheat oven to 425¬∞F (220¬∞C).",
         "Toss potatoes with 2 tbsp olive oil, salt, and pepper. Spread on a baking sheet.",
         "Season chicken thighs generously with salt and pepper.",
         "Nestle chicken among potatoes, skin-side up.",
         "Scatter garlic, lemon slices, and herbs around the pan.",
         "Drizzle remaining olive oil over chicken.",
         "Roast for 40-45 minutes until chicken is golden and potatoes are tender.",
         "Let rest 5 minutes before serving."
       ],
       sourceUrl: "https://www.instagram.com/p/example2/",
       thumbnailUrl: "https://picsum.photos/seed/chicken/400/300"
     },
     {
       title: "Quick Veggie Stir Fry",
       ingredients: [
         "2 cups broccoli florets",
         "1 red bell pepper, sliced",
         "1 cup snap peas",
         "3 cloves garlic, minced",
         "2 tbsp soy sauce",
         "1 tbsp sesame oil",
         "1 tbsp rice vinegar",
         "1 tsp fresh ginger, grated",
         "Sesame seeds for garnish"
       ],
       steps: [
         "Mix soy sauce, rice vinegar, and ginger in a small bowl. Set aside.",
         "Heat sesame oil in a wok or large skillet over high heat.",
         "Add broccoli and stir fry for 2 minutes.",
         "Add bell pepper and snap peas. Cook another 2 minutes.",
         "Add garlic and cook 30 seconds until fragrant.",
         "Pour sauce over vegetables and toss to coat.",
         "Cook 1 more minute until sauce thickens slightly.",
         "Garnish with sesame seeds and serve over rice."
       ],
       sourceUrl: "https://www.instagram.com/p/example3/",
       thumbnailUrl: "https://picsum.photos/seed/stirfry/400/300"
     }
   ];

   export async function seedDatabase(db: SQLiteDatabase): Promise<void> {
     const existing = await getAllRecipes(db);
     if (existing.length > 0) {
       return; // Already seeded
     }

     for (const recipe of mockRecipes) {
       await saveRecipe(db, recipe);
     }
   }
   ```

2. Create `components/EmptyState.tsx`:
   ```typescript
   import { View, Text } from 'react-native';

   interface EmptyStateProps {
     title: string;
     message: string;
   }

   export function EmptyState({ title, message }: EmptyStateProps) {
     return (
       <View className="flex-1 items-center justify-center p-8">
         <Text className="text-xl font-semibold text-gray-900 text-center">
           {title}
         </Text>
         <Text className="text-gray-500 text-center mt-2">
           {message}
         </Text>
       </View>
     );
   }
   ```

3. Create `components/RecipeCard.tsx`:
   ```typescript
   import { View, Text, Pressable } from 'react-native';
   import { Image } from 'expo-image';
   import { Link } from 'expo-router';
   import { Recipe } from '@/lib/types';

   interface RecipeCardProps {
     recipe: Recipe;
   }

   export function RecipeCard({ recipe }: RecipeCardProps) {
     return (
       <Link href={`/recipe/${recipe.id}`} asChild>
         <Pressable className="flex-row p-4 bg-white border-b border-gray-100 active:bg-gray-50">
           {recipe.thumbnailUrl ? (
             <Image
               source={recipe.thumbnailUrl}
               style={{ width: 80, height: 80, borderRadius: 8 }}
               contentFit="cover"
               cachePolicy="disk"
               transition={200}
             />
           ) : (
             <View
               className="w-20 h-20 rounded-lg bg-gray-200 items-center justify-center"
             >
               <Text className="text-gray-400 text-2xl">üç≥</Text>
             </View>
           )}
           <View className="flex-1 ml-4 justify-center">
             <Text className="text-lg font-semibold text-gray-900" numberOfLines={2}>
               {recipe.title}
             </Text>
             <Text className="text-sm text-gray-500 mt-1">
               {recipe.ingredients.length} ingredients ¬∑ {recipe.steps.length} steps
             </Text>
           </View>
         </Pressable>
       </Link>
     );
   }
   ```

4. Update `app/(tabs)/index.tsx` with full recipe list:
   ```typescript
   import { useEffect, useState, useCallback } from 'react';
   import { FlatList, View, RefreshControl } from 'react-native';
   import { useSQLiteContext } from 'expo-sqlite';
   import { useFocusEffect } from 'expo-router';
   import { getAllRecipes, Recipe } from '@/lib/db';
   import { seedDatabase } from '@/lib/mock-data';
   import { RecipeCard } from '@/components/RecipeCard';
   import { EmptyState } from '@/components/EmptyState';

   export default function RecipeList() {
     const db = useSQLiteContext();
     const [recipes, setRecipes] = useState<Recipe[]>([]);
     const [refreshing, setRefreshing] = useState(false);

     const loadRecipes = useCallback(async () => {
       // Seed mock data on first run
       await seedDatabase(db);
       const data = await getAllRecipes(db);
       setRecipes(data);
     }, [db]);

     // Reload when screen comes into focus (after delete, etc.)
     useFocusEffect(
       useCallback(() => {
         loadRecipes();
       }, [loadRecipes])
     );

     const onRefresh = async () => {
       setRefreshing(true);
       await loadRecipes();
       setRefreshing(false);
     };

     if (recipes.length === 0) {
       return (
         <EmptyState
           title="No Recipes Yet"
           message="Share an Instagram video to add your first recipe"
         />
       );
     }

     return (
       <FlatList
         data={recipes}
         keyExtractor={(item) => item.id}
         renderItem={({ item }) => <RecipeCard recipe={item} />}
         refreshControl={
           <RefreshControl refreshing={refreshing} onRefresh={onRefresh} />
         }
         contentContainerStyle={{ flexGrow: 1 }}
         className="flex-1 bg-gray-50"
       />
     );
   }
   ```

5. Update `app/(tabs)/_layout.tsx` to set proper header:
   ```typescript
   import { Tabs } from 'expo-router';

   export default function TabLayout() {
     return (
       <Tabs screenOptions={{
         tabBarActiveTintColor: '#0ea5e9',
         headerShown: true,
       }}>
         <Tabs.Screen
           name="index"
           options={{
             title: 'My Recipes',
             headerTitle: 'WeChef',
           }}
         />
       </Tabs>
     );
   }
   ```
  </action>
  <verify>
Run `npx expo start --ios`. Confirm:
1. App displays 3 mock recipes in a scrollable list
2. Each recipe shows thumbnail image, title, and ingredient/step count
3. Pull-to-refresh works
4. Images load from picsum.photos placeholders
  </verify>
  <done>
Recipe list displays 3 mock recipes with thumbnails. Pull-to-refresh reloads data. Empty state shows when no recipes. FlatList scrolls properly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Recipe Detail Screen with Delete and External Link</name>
  <files>
    app/recipe/[id].tsx
    components/RecipeDetail.tsx
    app/_layout.tsx
  </files>
  <action>
Create the recipe detail view with full recipe display, delete functionality, and Instagram link:

1. Create `components/RecipeDetail.tsx`:
   ```typescript
   import { View, Text, ScrollView, Pressable, Alert } from 'react-native';
   import { Image } from 'expo-image';
   import * as Linking from 'expo-linking';
   import { Recipe } from '@/lib/types';

   interface RecipeDetailProps {
     recipe: Recipe;
     onDelete: () => void;
   }

   export function RecipeDetail({ recipe, onDelete }: RecipeDetailProps) {
     const handleOpenSource = async () => {
       if (!recipe.sourceUrl) return;

       const canOpen = await Linking.canOpenURL(recipe.sourceUrl);
       if (canOpen) {
         await Linking.openURL(recipe.sourceUrl);
       } else {
         Alert.alert('Error', 'Cannot open this URL');
       }
     };

     const handleDelete = () => {
       Alert.alert(
         'Delete Recipe',
         'Are you sure you want to delete this recipe?',
         [
           { text: 'Cancel', style: 'cancel' },
           { text: 'Delete', style: 'destructive', onPress: onDelete },
         ]
       );
     };

     return (
       <ScrollView className="flex-1 bg-white">
         {/* Hero Image */}
         {recipe.thumbnailUrl && (
           <Image
             source={recipe.thumbnailUrl}
             style={{ width: '100%', height: 250 }}
             contentFit="cover"
             cachePolicy="disk"
           />
         )}

         <View className="p-4">
           {/* Title */}
           <Text className="text-2xl font-bold text-gray-900">
             {recipe.title}
           </Text>

           {/* Source Link */}
           {recipe.sourceUrl && (
             <Pressable
               onPress={handleOpenSource}
               className="mt-2 py-2"
             >
               <Text className="text-blue-600 underline">
                 View original on Instagram
               </Text>
             </Pressable>
           )}

           {/* Ingredients Section */}
           <View className="mt-6">
             <Text className="text-lg font-semibold text-gray-900 mb-3">
               Ingredients
             </Text>
             {recipe.ingredients.map((ingredient, index) => (
               <View key={index} className="flex-row mb-2">
                 <Text className="text-gray-400 mr-2">‚Ä¢</Text>
                 <Text className="text-gray-700 flex-1">{ingredient}</Text>
               </View>
             ))}
           </View>

           {/* Steps Section */}
           <View className="mt-6">
             <Text className="text-lg font-semibold text-gray-900 mb-3">
               Instructions
             </Text>
             {recipe.steps.map((step, index) => (
               <View key={index} className="flex-row mb-4">
                 <View className="w-6 h-6 rounded-full bg-sky-500 items-center justify-center mr-3 mt-0.5">
                   <Text className="text-white text-sm font-medium">
                     {index + 1}
                   </Text>
                 </View>
                 <Text className="text-gray-700 flex-1">{step}</Text>
               </View>
             ))}
           </View>

           {/* Delete Button */}
           <Pressable
             onPress={handleDelete}
             className="mt-8 mb-8 py-3 px-4 bg-red-50 rounded-lg border border-red-200 active:bg-red-100"
           >
             <Text className="text-red-600 text-center font-medium">
               Delete Recipe
             </Text>
           </Pressable>
         </View>
       </ScrollView>
     );
   }
   ```

2. Create `app/recipe/[id].tsx` (dynamic route):
   ```typescript
   import { useEffect, useState } from 'react';
   import { View, Text, ActivityIndicator } from 'react-native';
   import { useLocalSearchParams, useRouter, Stack } from 'expo-router';
   import { useSQLiteContext } from 'expo-sqlite';
   import { getRecipeById, deleteRecipe, Recipe } from '@/lib/db';
   import { RecipeDetail } from '@/components/RecipeDetail';

   export default function RecipeScreen() {
     const { id } = useLocalSearchParams<{ id: string }>();
     const router = useRouter();
     const db = useSQLiteContext();
     const [recipe, setRecipe] = useState<Recipe | null>(null);
     const [loading, setLoading] = useState(true);

     useEffect(() => {
       loadRecipe();
     }, [id]);

     const loadRecipe = async () => {
       if (!id) return;
       setLoading(true);
       const data = await getRecipeById(db, id);
       setRecipe(data);
       setLoading(false);
     };

     const handleDelete = async () => {
       if (!id) return;
       await deleteRecipe(db, id);
       router.back();
     };

     if (loading) {
       return (
         <View className="flex-1 items-center justify-center bg-white">
           <ActivityIndicator size="large" color="#0ea5e9" />
         </View>
       );
     }

     if (!recipe) {
       return (
         <View className="flex-1 items-center justify-center bg-white p-8">
           <Text className="text-xl font-semibold text-gray-900">
             Recipe Not Found
           </Text>
           <Text className="text-gray-500 mt-2 text-center">
             This recipe may have been deleted
           </Text>
         </View>
       );
     }

     return (
       <>
         <Stack.Screen
           options={{
             title: recipe.title,
             headerBackTitle: 'Recipes',
           }}
         />
         <RecipeDetail recipe={recipe} onDelete={handleDelete} />
       </>
     );
   }
   ```

3. Update `app/_layout.tsx` to include the recipe stack screen:
   ```typescript
   import '../global.css';
   import { Stack } from 'expo-router';
   import { SQLiteProvider } from 'expo-sqlite';
   import { initDatabase } from '@/lib/db';

   export default function RootLayout() {
     return (
       <SQLiteProvider databaseName="wechef.db" onInit={initDatabase}>
         <Stack>
           <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
           <Stack.Screen
             name="recipe/[id]"
             options={{
               headerShown: true,
               presentation: 'card',
             }}
           />
           <Stack.Screen name="+not-found" />
         </Stack>
       </SQLiteProvider>
     );
   }
   ```

4. Ensure expo-linking is installed (should be from Plan 01):
   ```bash
   npx expo install expo-linking
   ```
  </action>
  <verify>
Run `npx expo start --ios`. Confirm:
1. Tap any recipe from list -> navigates to detail screen
2. Detail screen shows hero image, title, ingredients list, numbered steps
3. "View original on Instagram" link is tappable (opens external browser/app)
4. Delete button shows confirmation alert
5. After confirming delete, navigates back to list and recipe is gone
6. List updates after delete (recipe no longer appears)
  </verify>
  <done>
Recipe detail screen shows full recipe with image, ingredients, and numbered steps. Delete button removes recipe from database and returns to list. Instagram link opens external URL. Navigation works correctly in both directions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify Complete Phase 1 Functionality</name>
  <what-built>
Complete recipe collection app with:
- Scrollable recipe list with thumbnails
- Recipe detail view with ingredients and steps
- Delete functionality with confirmation
- External Instagram URL linking
- Local SQLite persistence
- Offline image caching (expo-image disk cache)
- Mock data seeded on first launch
  </what-built>
  <how-to-verify>
Test the complete user flow:

1. **Launch and View List**
   - Open app in iOS simulator: `npx expo start --ios`
   - Verify 3 mock recipes appear with thumbnails and titles
   - Scroll the list to confirm it's scrollable

2. **View Recipe Details**
   - Tap "Creamy Garlic Tuscan Shrimp"
   - Verify you see:
     - Hero image at top
     - Recipe title
     - "View original on Instagram" link
     - Ingredients list with bullets
     - Numbered steps (1-8)
     - Red "Delete Recipe" button at bottom

3. **Test External Link**
   - Tap "View original on Instagram"
   - Should open Safari/Instagram (URL won't work but should attempt to open)

4. **Test Delete Flow**
   - Go back to list, tap "One-Pan Lemon Herb Chicken"
   - Tap "Delete Recipe"
   - Confirm the alert appears
   - Tap "Cancel" - recipe should remain
   - Tap "Delete Recipe" again, then confirm "Delete"
   - Verify you return to list and recipe is gone (now 2 recipes)

5. **Test Persistence**
   - Note which recipes remain (should be 2)
   - Stop the app completely (Cmd+Q in simulator)
   - Restart the app
   - Verify the same 2 recipes appear (deleted one stays deleted)

6. **Test Offline Images**
   - With app running, enable Airplane Mode on simulator
   - Pull to refresh or navigate between screens
   - Images should still display (cached to disk)

Expected result: All features work as described. Recipe data persists across restarts. Images work offline.
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Phase 1 Success Criteria from ROADMAP.md:
1. [x] User can view a scrollable list of saved recipes with titles and thumbnails
2. [x] User can tap a recipe to see full detail view with ingredients, steps, photo, and original URL link
3. [x] User can save a recipe and it persists after app restart (mock data seeded, persists in SQLite)
4. [x] User can delete a recipe from the collection
5. [x] Recipes are viewable offline after saving (expo-image cachePolicy="disk")

Requirements Coverage:
- DISP-01: View structured recipe (ingredients list, numbered steps) - RecipeDetail component
- DISP-02: See recipe thumbnail/photo - RecipeCard and RecipeDetail with expo-image
- DISP-03: Tap to open original Instagram URL - Linking.openURL in RecipeDetail
- STOR-01: Save recipe to local collection - saveRecipe in lib/db.ts (used by seedDatabase)
- STOR-02: Persist across restarts - SQLite database
- STOR-03: Delete recipe from collection - deleteRecipe in lib/db.ts
- STOR-04: Offline availability - expo-image cachePolicy="disk"
- COLL-01: Browse all saved recipes - FlatList in index.tsx
- COLL-02: Recipe list shows title and thumbnail - RecipeCard component
</verification>

<success_criteria>
- Recipe list displays with thumbnails and titles
- Recipe detail shows all fields (image, title, ingredients, steps, link)
- Delete removes recipe and persists after restart
- Instagram link attempts to open external URL
- Images remain visible when offline
- No crashes or errors during normal usage
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-ui-shell/01-02-SUMMARY.md`
</output>
