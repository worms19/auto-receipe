---
phase: 01-foundation-ui-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/_layout.tsx
  - app/(tabs)/_layout.tsx
  - app/(tabs)/index.tsx
  - lib/db.ts
  - lib/types.ts
  - lib/utils.ts
  - global.css
  - tailwind.config.js
  - metro.config.js
  - babel.config.js
  - nativewind-env.d.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "App launches without errors on iOS simulator"
    - "NativeWind className styling is applied to components"
    - "SQLite database is created with recipes table on first launch"
  artifacts:
    - path: "app/_layout.tsx"
      provides: "Root layout with SQLiteProvider and global.css import"
      contains: "SQLiteProvider"
    - path: "lib/db.ts"
      provides: "Database initialization and CRUD helpers"
      exports: ["getAllRecipes", "getRecipeById", "saveRecipe", "deleteRecipe"]
    - path: "lib/types.ts"
      provides: "Recipe type definitions"
      exports: ["Recipe", "RecipeRow"]
    - path: "tailwind.config.js"
      provides: "NativeWind Tailwind configuration"
      contains: "nativewind/preset"
  key_links:
    - from: "app/_layout.tsx"
      to: "lib/db.ts"
      via: "SQLiteProvider onInit callback"
      pattern: "onInit.*initDatabase"
    - from: "app/_layout.tsx"
      to: "global.css"
      via: "import statement"
      pattern: "import.*global\\.css"
---

<objective>
Initialize the WeChef Expo project with TypeScript, configure NativeWind for Tailwind styling, and set up SQLite for local recipe storage.

Purpose: Establish the foundational infrastructure that all UI components and features will build upon.
Output: Working Expo app with NativeWind styling and SQLite database ready for recipe CRUD operations.
</objective>

<execution_context>
@/Users/damienanselmi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/damienanselmi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-ui-shell/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Expo Project with TypeScript and Core Dependencies</name>
  <files>
    package.json
    app/_layout.tsx
    app/(tabs)/_layout.tsx
    app/(tabs)/index.tsx
    app/+not-found.tsx
    tsconfig.json
  </files>
  <action>
Create new Expo project using TypeScript template and install all Phase 1 dependencies:

1. Create project:
   ```bash
   npx create-expo-app@latest WeChef --template expo-template-blank-typescript
   ```
   Note: Run this in the parent directory, then move contents to current directory (or work with the created folder).

2. Install core dependencies:
   ```bash
   npx expo install expo-sqlite expo-image expo-linking
   ```

3. Install NativeWind with EXACT versions (proven stable for SDK 52):
   ```bash
   npm install nativewind@4.1.23 tailwindcss@3.4.17
   ```

4. Install additional Expo dependencies:
   ```bash
   npx expo install react-native-reanimated react-native-safe-area-context expo-status-bar
   ```

5. Set up Expo Router file structure:
   - Create `app/` directory with `_layout.tsx` (root layout)
   - Create `app/(tabs)/` directory with `_layout.tsx` (tab navigator) and `index.tsx` (home/recipe list)
   - Create basic `app/+not-found.tsx` for 404 handling

The root layout should be a minimal placeholder that exports a Stack navigator. The (tabs) layout should set up a single tab for now (Recipes). The index.tsx should render a simple placeholder View with Text.

Do NOT configure NativeWind yet (Task 2) or SQLite (Task 3) - just get the project structure working.
  </action>
  <verify>
Run `npx expo start --ios` and confirm app launches in iOS simulator with placeholder content visible. No red error screens.
  </verify>
  <done>
Expo project runs on iOS simulator. Package.json contains expo-sqlite, expo-image, nativewind@4.1.23, tailwindcss@3.4.17. File structure includes app/_layout.tsx, app/(tabs)/_layout.tsx, app/(tabs)/index.tsx.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure NativeWind with Tailwind CSS</name>
  <files>
    tailwind.config.js
    metro.config.js
    babel.config.js
    global.css
    nativewind-env.d.ts
    app/_layout.tsx
    app/(tabs)/index.tsx
  </files>
  <action>
Configure NativeWind for Tailwind CSS styling in React Native:

1. Create `tailwind.config.js`:
   ```javascript
   /** @type {import('tailwindcss').Config} */
   module.exports = {
     content: [
       "./app/**/*.{js,jsx,ts,tsx}",
       "./components/**/*.{js,jsx,ts,tsx}"
     ],
     presets: [require("nativewind/preset")],
     theme: {
       extend: {},
     },
     plugins: [],
   }
   ```

2. Create/update `metro.config.js`:
   ```javascript
   const { getDefaultConfig } = require("expo/metro-config");
   const { withNativeWind } = require("nativewind/metro");

   const config = getDefaultConfig(__dirname);

   module.exports = withNativeWind(config, { input: "./global.css" });
   ```

3. Update `babel.config.js`:
   ```javascript
   module.exports = function (api) {
     api.cache(true);
     return {
       presets: [
         ["babel-preset-expo", { jsxImportSource: "nativewind" }],
         "nativewind/babel",
       ],
     };
   };
   ```

4. Create `global.css`:
   ```css
   @tailwind base;
   @tailwind components;
   @tailwind utilities;
   ```

5. Create `nativewind-env.d.ts` for TypeScript support:
   ```typescript
   /// <reference types="nativewind/types" />
   ```

6. Update `app/_layout.tsx` to import global.css:
   ```typescript
   import '../global.css';
   // ... rest of layout
   ```

7. Update `app/(tabs)/index.tsx` to use className for styling:
   ```typescript
   <View className="flex-1 items-center justify-center bg-white">
     <Text className="text-xl font-bold text-gray-900">WeChef</Text>
     <Text className="text-gray-500 mt-2">Your recipes will appear here</Text>
   </View>
   ```

IMPORTANT: After config changes, clear Metro cache and restart:
```bash
npx expo start --clear
```
  </action>
  <verify>
Run `npx expo start --ios --clear`. Confirm app displays styled text (large bold "WeChef", gray subtitle). The className styles must be visibly applied (not unstyled default text). Check Metro bundler output for NativeWind processing messages.
  </verify>
  <done>
NativeWind styling works. Text appears with correct font sizes and colors. No "className has no effect" issues. Metro config processes global.css through NativeWind.
  </done>
</task>

<task type="auto">
  <name>Task 3: Set Up SQLite Database with Recipe Schema and Helpers</name>
  <files>
    lib/types.ts
    lib/db.ts
    lib/utils.ts
    app/_layout.tsx
  </files>
  <action>
Create the database layer with SQLite for recipe storage:

1. Create `lib/types.ts` with Recipe types:
   ```typescript
   // Database row shape (snake_case, JSON strings for arrays)
   export interface RecipeRow {
     id: string;
     title: string;
     ingredients: string;  // JSON string array
     steps: string;        // JSON string array
     source_url: string | null;
     thumbnail_url: string | null;
     created_at: number;   // Unix timestamp
     updated_at: number;   // Unix timestamp
   }

   // Application shape (camelCase, parsed arrays)
   export interface Recipe {
     id: string;
     title: string;
     ingredients: string[];
     steps: string[];
     sourceUrl: string | null;
     thumbnailUrl: string | null;
     createdAt: Date;
     updatedAt: Date;
   }

   // For creating new recipes (omit auto-generated fields)
   export type NewRecipe = Omit<Recipe, 'id' | 'createdAt' | 'updatedAt'>;
   ```

2. Create `lib/utils.ts` with helper functions:
   ```typescript
   import { type ClassValue, clsx } from 'clsx';
   import { twMerge } from 'tailwind-merge';

   export function cn(...inputs: ClassValue[]) {
     return twMerge(clsx(inputs));
   }

   export function generateId(): string {
     return crypto.randomUUID();
   }
   ```
   Note: Install clsx and tailwind-merge: `npm install clsx tailwind-merge`

3. Create `lib/db.ts` with database initialization and CRUD:
   ```typescript
   import { SQLiteDatabase } from 'expo-sqlite';
   import { Recipe, RecipeRow, NewRecipe } from './types';
   import { generateId } from './utils';

   const DATABASE_VERSION = 1;

   export async function initDatabase(db: SQLiteDatabase): Promise<void> {
     const result = await db.getFirstAsync<{ user_version: number }>(
       'PRAGMA user_version'
     );
     const currentVersion = result?.user_version ?? 0;

     if (currentVersion >= DATABASE_VERSION) {
       return;
     }

     if (currentVersion === 0) {
       await db.execAsync(`
         CREATE TABLE IF NOT EXISTS recipes (
           id TEXT PRIMARY KEY,
           title TEXT NOT NULL,
           ingredients TEXT NOT NULL,
           steps TEXT NOT NULL,
           source_url TEXT,
           thumbnail_url TEXT,
           created_at INTEGER NOT NULL,
           updated_at INTEGER NOT NULL
         );
         CREATE INDEX IF NOT EXISTS idx_recipes_created
         ON recipes(created_at DESC);
       `);
     }

     await db.execAsync(`PRAGMA user_version = ${DATABASE_VERSION}`);
   }

   export function parseRecipeRow(row: RecipeRow): Recipe {
     return {
       id: row.id,
       title: row.title,
       ingredients: JSON.parse(row.ingredients),
       steps: JSON.parse(row.steps),
       sourceUrl: row.source_url,
       thumbnailUrl: row.thumbnail_url,
       createdAt: new Date(row.created_at),
       updatedAt: new Date(row.updated_at),
     };
   }

   export async function getAllRecipes(db: SQLiteDatabase): Promise<Recipe[]> {
     const rows = await db.getAllAsync<RecipeRow>(
       'SELECT * FROM recipes ORDER BY created_at DESC'
     );
     return rows.map(parseRecipeRow);
   }

   export async function getRecipeById(
     db: SQLiteDatabase,
     id: string
   ): Promise<Recipe | null> {
     const row = await db.getFirstAsync<RecipeRow>(
       'SELECT * FROM recipes WHERE id = ?',
       [id]
     );
     return row ? parseRecipeRow(row) : null;
   }

   export async function saveRecipe(
     db: SQLiteDatabase,
     recipe: NewRecipe
   ): Promise<string> {
     const id = generateId();
     const now = Date.now();

     await db.runAsync(
       `INSERT INTO recipes (id, title, ingredients, steps, source_url, thumbnail_url, created_at, updated_at)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
       [
         id,
         recipe.title,
         JSON.stringify(recipe.ingredients),
         JSON.stringify(recipe.steps),
         recipe.sourceUrl,
         recipe.thumbnailUrl,
         now,
         now,
       ]
     );

     return id;
   }

   export async function deleteRecipe(
     db: SQLiteDatabase,
     id: string
   ): Promise<void> {
     await db.runAsync('DELETE FROM recipes WHERE id = ?', [id]);
   }
   ```

4. Update `app/_layout.tsx` to wrap app in SQLiteProvider:
   ```typescript
   import '../global.css';
   import { Stack } from 'expo-router';
   import { SQLiteProvider } from 'expo-sqlite';
   import { initDatabase } from '@/lib/db';

   export default function RootLayout() {
     return (
       <SQLiteProvider databaseName="wechef.db" onInit={initDatabase}>
         <Stack>
           <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
           <Stack.Screen name="+not-found" />
         </Stack>
       </SQLiteProvider>
     );
   }
   ```

5. Verify the database works by temporarily adding a test in index.tsx:
   ```typescript
   import { useSQLiteContext } from 'expo-sqlite';
   import { useEffect, useState } from 'react';
   import { getAllRecipes, Recipe } from '@/lib/db';

   export default function RecipeList() {
     const db = useSQLiteContext();
     const [count, setCount] = useState<number>(0);

     useEffect(() => {
       getAllRecipes(db).then(recipes => setCount(recipes.length));
     }, []);

     return (
       <View className="flex-1 items-center justify-center bg-white">
         <Text className="text-xl font-bold text-gray-900">WeChef</Text>
         <Text className="text-gray-500 mt-2">
           {count} recipes in database
         </Text>
       </View>
     );
   }
   ```
  </action>
  <verify>
Run `npx expo start --ios`. App launches and displays "0 recipes in database" (proving SQLite connection works). No database errors in console. Check that wechef.db is created (visible in Expo dev tools or console logs).
  </verify>
  <done>
SQLite database initialized with recipes table. lib/db.ts exports getAllRecipes, getRecipeById, saveRecipe, deleteRecipe. App displays recipe count from database. SQLiteProvider wraps entire app.
  </done>
</task>

</tasks>

<verification>
1. `npx expo start --ios` launches app without errors
2. NativeWind className styling is visibly applied (styled text, not default)
3. SQLite database query executes successfully (shows "0 recipes")
4. No TypeScript errors in lib/types.ts, lib/db.ts, lib/utils.ts
5. All files exist: app/_layout.tsx, app/(tabs)/_layout.tsx, app/(tabs)/index.tsx, lib/db.ts, lib/types.ts, global.css, tailwind.config.js, metro.config.js, babel.config.js
</verification>

<success_criteria>
- App launches on iOS simulator without red error screens
- Text displays with Tailwind styling (font sizes, colors work)
- Database connection verified (recipe count displays)
- Project structure matches Expo Router conventions
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-ui-shell/01-01-SUMMARY.md`
</output>
